document.addEventListener("DOMContentLoaded", function () {
    const popupOverlay = document.querySelector(".grid-popup-overlay");
    const closePopup = document.querySelector(".grid-close-popup");
    const popupImage = document.getElementById("popup-image");
    const popupTitle = document.getElementById("popup-title");
    const popupPrice = document.getElementById("popup-price");
    const popupDescription = document.getElementById("popup-description");
    const colorDropdown = document.getElementById("popup-color");
    const sizeDropdown = document.getElementById("popup-size");
    const addToCartButton = document.querySelector(".grid-add-to-cart");
    
    document.querySelectorAll(".grid-popup-btn").forEach(button => {
        button.addEventListener("click", function () {
            const productId = this.dataset.productId;
            const products = JSON.parse(document.getElementById("product-data").textContent);
            const product = products.find(p => p.id == productId);

            if (product) {
                popupImage.src = product.featured_image.src;
                popupTitle.innerText = product.title;
                popupPrice.innerText = product.price + " â‚¬";
                popupDescription.innerText = product.description;
                
                // Populate Color Options
                colorDropdown.innerHTML = '<option value="">Choose your color</option>';
                const colors = new Set();
                product.variants.forEach(variant => {
                    if (variant.option1 && !colors.has(variant.option1)) {
                        colors.add(variant.option1);
                        const option = document.createElement("option");
                        option.value = variant.option1;
                        option.textContent = variant.option1;
                        colorDropdown.appendChild(option);
                    }
                });
            }
            
            popupOverlay.style.display = "flex";
        });
    });

    closePopup.addEventListener("click", function () {
        popupOverlay.style.display = "none";
    });

    popupOverlay.addEventListener("click", function (e) {
        if (e.target === popupOverlay) popupOverlay.style.display = "none";
    });

    addToCartButton.addEventListener("click", function () {
        const selectedColor = colorDropdown.value;
        const selectedSize = sizeDropdown.value;
        if (!selectedColor || !selectedSize) {
            alert("Please select a color and size.");
            return;
        }
        alert(`Added to cart: ${popupTitle.innerText} - Color: ${selectedColor}, Size: ${selectedSize}`);
    });
});
