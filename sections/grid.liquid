<section class="custom-grid-section">
  <h2 class="grid-title">Tisso Vision in the Wild</h2>
  <div class="grid-container">
    {% for product in collections['all'].products limit:6 %}
      <div class="grid-item">
        <img src="{{ product.featured_image | img_url: 'large' }}" alt="{{ product.title }}">
        <button class="quick-view-btn" data-product-id="{{ product.id }}">+</button>
      </div>
    {% endfor %}
  </div>

  <div id="quick-view-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <div class="modal-body"></div>
    </div>
  </div>
</section>

<style>
  .custom-grid-section { text-align: center; padding: 20px; }
  .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
  .grid-item { position: relative; cursor: pointer; }
  .grid-item img { width: 100%; border-radius: 5px; }
  .quick-view-btn { position: absolute; top: 10px; right: 10px; background: black; color: white; border: none; cursor: pointer; }
  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
  .modal-content { background: white; padding: 20px; position: relative; top: 50%; transform: translateY(-50%); width: 300px; margin: auto; border-radius: 5px; }
  .close-modal { position: absolute; top: 10px; right: 10px; cursor: pointer; }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const buttons = document.querySelectorAll(".quick-view-btn");
    const modal = document.getElementById("quick-view-modal");
    const modalBody = document.querySelector(".modal-body");
    const closeModal = document.querySelector(".close-modal");

    buttons.forEach(button => {
      button.addEventListener("click", function() {
        const productId = this.getAttribute("data-product-id");

        fetch(`/products/${productId}.js`)
          .then(response => response.json())
          .then(data => {
            modalBody.innerHTML = `
              <h3>${data.title}</h3>
              <img src="${data.images[0]}" style="width: 100%;">
              <p>${data.price / 100} ${Shopify.currency.active}</p>
              <button onclick="addToCart(${data.variants[0].id})">Add to Cart</button>
            `;
            modal.style.display = "block";
          });
      });
    });

    closeModal.addEventListener("click", () => {
      modal.style.display = "none";
    });

    function addToCart(variantId) {
      fetch('/cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ quantity: 1, id: variantId })
      }).then(() => alert("Added to cart!"));
    }
  });
</script>
